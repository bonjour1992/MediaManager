select name ,nb_seen ,nb_tot,( (nb_seen/nb_tot)/((select count(media ) from rating where user='' and media like 'm%' )/(select count(id) from media where id like 'm%'))) as delta_seen ,rate,(rate-(select avg(rate) from rating where user='1' and media like'm%')) as delta_rate from (select name,count(object) as nb_seen,avg(rate) as rate from link join media on properties=id join rating on media=object where properties like 'k%' group by properties ) as  seen natural join (select name,count(object) as nb_tot from link join media on properties=id  where properties like 'k%' group by properties having count(object)>20  ) as tot  order by nb_seen desc

